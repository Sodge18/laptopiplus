<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>

    <title>Laptopi Plus Shop Page</title>

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#333333",
                        "background-light": "#ffffff",
                        "background-dark": "#1f2937",
                    },
                    fontFamily: { display: ["Poppins", "sans-serif"] },
                    borderRadius: {
                        DEFAULT: "0.75rem",
                        xl: "1.25rem",
                        "2xl": "1.5rem",
                    },
                },
            },
        };
    </script>

    <style>
        [x-cloak] { display: none !important; }

        .carousel-container {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .carousel-container::-webkit-scrollbar {
            display: none;
        }

        .carousel-item {
            scroll-snap-align: start;
        }

        .invalid-field {
            border: 2px solid #f87171;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-gray-700 dark:text-gray-300">

<!-- NAVBAR -->
<header class="py-6 px-4 sm:px-6 lg:px-8">
    <div class="container mx-auto flex justify-between items-center relative">
        <a class="text-2xl font-bold text-gray-900 dark:text-white" href="#">Laptopi Plus</a>

        <nav class="hidden md:flex items-center space-x-8 absolute left-1/2 -translate-x-1/2">
            <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-white font-semibold" href="#">Laptopi</a>
            <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-white font-semibold" href="#">Kontakt</a>
        </nav>
    </div>
</header>

<!-- HERO -->
<section class="relative h-96 flex items-center justify-center text-white overflow-hidden">
    <img alt="Hero" class="absolute inset-0 w-full h-full object-cover z-0"
         src="https://lh3.googleusercontent.com/aida-public/AB6AXuA5sVuCtmqZpZ0D8iLshqCe6NaEx0MCjcckHpCFulGhRxoTE1dNfTaFr1vSB7I5IQM2fwQjHE3VtjSyu6x_wgg17LC6MUYNEbcobkIuzjscpJWcohj8e9fqch19RWWUsRTs-XqnE8lBDaGxCBjf65aZd1cg79cNRSCfL3rdjhtuj3Z6zJt85ogQMiv1gNAyNnnVOO9t--q_C_M-Ft1U50YWUe-w_XV3w9jdAo_C76vKZqY4lskd91i6ZYtncUQP06fKFaE_SlMkUF_Y"/>
    <div class="absolute inset-0 bg-black opacity-50 z-10"></div>

    <div class="relative z-20 text-center">
        <h1 class="text-6xl md:text-8xl font-bold">Laptopi Plus</h1>
        <p class="mt-4 text-xl">Laptopi za sve namene!</p>
    </div>
</section>

<!-- CAROUSEL -->
<main class="container mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="text-center mb-12">
        <h2 class="text-3xl font-semibold text-gray-800 dark:text-gray-200">
            Naša ponuda laptopa
        </h2>
    </div>

    <div class="relative max-w-4xl mx-auto">

        <div id="carousel"
             class="carousel-container flex overflow-x-auto snap-x snap-mandatory scroll-smooth pb-4">
            <div class="w-full flex justify-center items-center h-96">
                <p class="text-gray-500">Učitavanje laptopova...</p>
            </div>
        </div>

        <!-- Strelice -->
        <button id="prev-btn"
                class="absolute top-1/2 left-0 -translate-y-1/2 -translate-x-12
                       bg-gray-100 dark:bg-gray-700/50 p-3 rounded-full shadow-md
                       hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors z-10">
            <span class="material-icons text-gray-800 dark:text-white">arrow_back_ios_new</span>
        </button>

        <button id="next-btn"
                class="absolute top-1/2 right-0 -translate-y-1/2 translate-x-12
                       bg-gray-100 dark:bg-gray-700/50 p-3 rounded-full shadow-md
                       hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors z-10">
            <span class="material-icons text-gray-800 dark:text-white">arrow_forward_ios</span>
        </button>
    </div>

    <div id="pagination-dots" class="flex justify-center items-center mt-12 space-x-2"></div>
</main>

<!-- CONTACT FORM – FULL WIDTH BLOCK -->
<section id="contact-form-section" class="relative py-24 overflow-hidden">
  <!-- Pozadina sa gradientom i talasima -->
  <div class="absolute inset-0 bg-gradient-to-br from-primary via-primary/90 to-black"></div>
  <div class="absolute inset-0 opacity-20">
    <svg class="w-full h-full" viewBox="0 0 1440 560" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M0 0L1440 320L0 560V0Z" fill="white"/>
      <path d="M0 100L1440 420L0 660V100Z" fill="white" opacity="0.1"/>
    </svg>
  </div>

  <div class="relative container mx-auto px-6 lg:px-8 z-10">
    <div class="max-w-5xl mx-auto">
      <div class="text-center mb-16">
        <h2 class="text-5xl md:text-7xl font-black text-white mb-6">
          Spremni za savršeni laptop?
        </h2>
        <p class="text-2xl text-white/90 font-medium">
          Ostavite upit – odgovaramo u roku od 24h
        </p>
      </div>

      <div class="bg-white/10 backdrop-blur-xl rounded-3xl shadow-2xl p-10 md:p-16 border border-white/20">
        <form id="contact-form" novalidate class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <div class="space-y-8">
            <div>
              <label class="block text-white/90 text-lg font-semibold mb-3">Ime</label>
              <input id="ime" type="text" placeholder="Vaše ime" required
                     class="w-full px-6 py-5 bg-white/20 border border-white/30 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:border-white focus:bg-white/30 transition text-lg"/>
              <p class="error-hint text-red-300 text-sm mt-2 hidden">Popunite polje</p>
            </div>
            <div>
              <label class="block text-white/90 text-lg font-semibold mb-3">Prezime</label>
              <input id="prezime" type="text" placeholder="Vaše prezime" required
                     class="w-full px-6 py-5 bg-white/20 border border-white/30 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:border-white focus:bg-white/30 transition text-lg"/>
              <p class="error-hint text-red-300 text-sm mt-2 hidden">Popunite polje</p>
            </div>
            <div>
              <label class="block text-white/90 text-lg font-semibold mb-3">Telefon</label>
              <input id="kontakt-broj" type="tel" placeholder="061 234 567" required
                     class="w-full px-6 py-5 bg-white/20 border border-white/30 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:border-white focus:bg-white/30 transition text-lg"/>
              <p class="error-hint text-red-300 text-sm mt-2 hidden">Popunite polje</p>
            </div>
            <div>
              <label class="block text-white/90 text-lg font-semibold mb-3">Email</label>
              <input id="email" type="email" placeholder="vas.email@gmail.com" required
                     class="w-full px-6 py-5 bg-white/20 border border-white/30 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:border-white focus:bg-white/30 transition text-lg"/>
              <p class="error-hint text-red-300 text-sm mt-2 hidden">Popunite polje</p>
            </div>
          </div>

          <div class="space-y-8">
            <div>
              <label class="block text-white/90 text-lg font-semibold mb-3">Koji laptop vas zanima?</label>
              <select id="laptop-select" required
                      class="w-full px-6 py-5 bg-white/20 border border-white/30 rounded-2xl text-white focus:outline-none focus:border-white focus:bg-white/30 transition text-lg">
                <option value="" class="text-gray-500">Izaberite model...</option>
              </select>
              <p class="error-hint text-red-300 text-sm mt-2 hidden">Izaberite laptop</p>
            </div>

            <div>
              <label class="block text-white/90 text-lg font-semibold mb-3">Poruka (nije obavezno)</label>
              <textarea id="poruka" rows="6" placeholder="Recite nam šta vam treba – budžet, namena, specifikacije..."
                        class="w-full px-6 py-5 bg-white/20 border border-white/30 rounded-2xl text-white placeholder-white/60 focus:outline-none focus:border-white focus:bg-white/30 transition resize-none text-lg"></textarea>
            </div>

            <div class="pt-6">
              <button type="submit"
                      class="w-full bg-white text-primary font-black text-2xl py-7 rounded-2xl hover:bg-gray-100 transform hover:scale-105 transition duration-300 shadow-2xl">
                POŠALJI UPIT ODMAH
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<!-- GRID — SVI NAŠI PROIZVODI (PROFESIONALNO IZDANJE) -->
<section class="py-24 bg-gray-50 dark:bg-gray-900">
  <div class="container mx-auto px-6 lg:px-8">
    <!-- Naslov -->
    <div class="text-center mb-16">
      <h2 class="text-5xl md:text-6xl font-bold text-gray-900 dark:text-white tracking-tight">
        Svi naši proizvodi
      </h2>
      <p class="mt-6 text-xl text-gray-600 dark:text-gray-400 max-w-3xl mx-auto leading-relaxed">
        Kompletna ponuda laptopova – od poslovnih klasa do gejming zveri i ultra-prenosivih modela.
      </p>
    </div>

    <!-- Grid -->
    <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-10">
      <!-- JS popunjava -->
      <div class="col-span-full text-center py-32">
        <p class="text-gray-500 dark:text-gray-400 text-lg">Učitavanje proizvoda...</p>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer class="bg-background-light dark:bg-background-dark">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="text-center text-sm text-gray-500 dark:text-gray-400">
            <p>Laptopi Plus — Laptopi za sve namene</p>
        </div>
    </div>
</footer>

<script>
const API_URL = "https://products-api.sergej-kaldesic.workers.dev/";
let allProducts = [];

/* =============================
   LOADING PRODUCTS (CAROUSEL + GRID)
============================= */
async function loadProducts() {
    try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error("Greška API: " + res.status);

        const data = await res.json();
        const products = Array.isArray(data.products) ? data.products :
                         Array.isArray(data) ? data : [];

        allProducts = products;

        renderCarousel(products);
        renderGrid(products);
        populateLaptopDropdown(products);
    } catch (e) {
        console.error(e);
    }
}

document.addEventListener("DOMContentLoaded", loadProducts);

/* =============================
   RENDER CAROUSEL
============================= */
function renderCarousel(products) {
    const carousel = document.getElementById("carousel");
    const dots = document.getElementById("pagination-dots");

    if (!products.length) {
        carousel.innerHTML = `<p class="text-center text-gray-500 py-20">Nema laptopova.</p>`;
        return;
    }

    carousel.innerHTML = products.map(p => {
        const img = p.image || p.images?.[0] || "https://via.placeholder.com/600?text=Laptop";
        const altText = p.title || "Laptop";

        return `
        <div class="carousel-item snap-center flex-shrink-0 w-full flex justify-center p-4">
            <div class="group relative flex flex-col w-full max-w-sm">
                <div onclick='goToProduct("${p.id}")' class="cursor-pointer">
                    <div class="relative w-full aspect-square bg-gray-100 dark:bg-gray-800 rounded-2xl overflow-hidden mb-6">
                        <img src="${img}" alt="${altText}" class="w-full h-full object-contain p-8 group-hover:scale-105 transition-transform duration-300">
                    </div>
                </div>

                <h3 class="font-semibold text-2xl text-center mb-2">${p.title}</h3>
                <p class="text-gray-500 dark:text-gray-400 text-base text-center mb-4">${p.shortDesc || ""}</p>

                <div class="text-center">
                    <p class="text-2xl font-bold">${p.price ? p.price + "€" : "Cena na upit"}</p>

                    <button onclick='goToProduct("${p.id}")'
                            class="mt-2 bg-gray-200 dark:bg-gray-700 px-6 py-2 rounded-full hover:bg-gray-300 dark:hover:bg-gray-600 w-full transition">
                        Detalji
                    </button>
                </div>
            </div>
        </div>`;
    }).join("");

    dots.innerHTML = products.map((_, i) =>
        `<button onclick="scrollToSlide(${i})"
                class="w-3 h-3 rounded-full transition-all ${i===0 ? "bg-primary w-8" : "bg-gray-300 dark:bg-gray-600"}"></button>`
    ).join("");

    document.getElementById("prev-btn").onclick = () => scrollCarousel(-1);
    document.getElementById("next-btn").onclick = () => scrollCarousel(1);
    carousel.addEventListener("scroll", updateActiveDot);
    updateActiveDot();
}

/* =============================
   CAROUSEL NAVIGATION LOGIC
============================= */
function scrollCarousel(dir) {
    const carousel = document.getElementById("carousel");
    const itemWidth = carousel.querySelector(".carousel-item")?.clientWidth || carousel.clientWidth;
    carousel.scrollBy({ left: dir * itemWidth, behavior: "smooth" });
}

function scrollToSlide(i) {
    const carousel = document.getElementById("carousel");
    const itemWidth = carousel.querySelector(".carousel-item")?.clientWidth || carousel.clientWidth;
    carousel.scrollTo({ left: i * itemWidth, behavior: "smooth" });
}

function updateActiveDot() {
    const carousel = document.getElementById("carousel");
    const dots = document.querySelectorAll("#pagination-dots button");
    const items = carousel.querySelectorAll(".carousel-item");
    const itemWidth = items[0]?.clientWidth || carousel.clientWidth;
    const active = Math.round(carousel.scrollLeft / itemWidth);

    dots.forEach((d, i) => {
        const isActive = i === active;
        d.classList.toggle("bg-primary", isActive);
        d.classList.toggle("w-8", isActive);
        d.classList.toggle("bg-gray-300", !isActive);
        d.classList.toggle("dark:bg-gray-600", !isActive);
        d.classList.toggle("w-3", !isActive);
    });
}

/* =============================
   RENDER GRID PRODUCTS
============================= */
function renderGrid(products) {
    const grid = document.getElementById("products-grid");

    if (!products.length) {
        grid.innerHTML = `
          <div class="col-span-full text-center py-32">
            <p class="text-2xl text-gray-500 dark:text-gray-400">Trenutno nema dostupnih proizvoda.</p>
          </div>`;
        return;
    }

    grid.innerHTML = products.map(p => {
        const img = p.images?.[0] || p.image || "https://via.placeholder.com/800x600/cccccc/666666?text=Laptop";
        const hasTag = p.tag && p.tag.trim() !== "";

        return `
        <article onclick="goToProduct('${p.id}')" 
                 class="group cursor-pointer bg-white dark:bg-gray-800 rounded-2xl shadow-md hover:shadow-2xl 
                        transition-all duration-500 overflow-hidden border border-gray-200 dark:border-gray-700
                        hover:border-primary/30 hover:-translate-y-3">
          
          <!-- Gornji deo: slika koja popunjava 100% -->
          <div class="relative h-64 overflow-hidden bg-gradient-to-b from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900">
            <img src="${img}" alt="${p.title}" 
                 class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
            
            <!-- Tag u gornjem desnom uglu -->
            ${hasTag ? `
            <div class="absolute top-4 right-4 z-10">
              <span class="inline-block px-4 py-2 text-xs font-bold tracking-wider uppercase rounded-full
                           bg-primary text-white shadow-lg">
                ${p.tag}
              </span>
            </div>` : ''}
          </div>

          <!-- Donji deo: tekst -->
          <div class="p-8">
            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-3 line-clamp-2 leading-tight">
              ${p.title}
            </h3>
            
            <p class="text-gray-600 dark:text-gray-400 text-sm mb-6 line-clamp-3 leading-relaxed">
              ${p.shortDesc || "Visokokvalitetni laptop sa najnovijim specifikacijama."}
            </p>

            <!-- Cena + strelica -->
            <div class="flex items-end justify-between mt-auto">
              <div>
                <div class="text-3xl font-extrabold text-gray-900 dark:text-white">
                  ${p.price ? p.price + "€" : "Cena na upit"}
                </div>
              </div>

              <div class="text-primary font-semibold text-lg opacity-0 group-hover:opacity-100 
                          translate-x-4 group-hover:translate-x-0 transition-all duration-500 flex items-center gap-2">
                Detalji 
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                </svg>
              </div>
            </div>
          </div>
        </article>`;
    }).join("");
}
/* =============================
   POPUNJAVANJE PADAJUĆEG MENIJA ZA LAPTOPE
============================= */
function populateLaptopDropdown(products) {
    const laptopSelect = document.getElementById("laptop-select");
    laptopSelect.innerHTML = '<option value="">Odaberite laptop</option>';

    products.forEach(p => {
        const option = document.createElement("option");
        option.value = p.id;       // ← ID umesto title
        option.textContent = p.title;
        laptopSelect.appendChild(option);
    });
}


/* =============================
   VALIDACIJA I SUBMIT FORME
============================= */
const form = document.getElementById("contact-form");
const requiredFields = ["ime", "prezime", "kontakt-broj", "email"];
const laptopSelectEl = document.getElementById("laptop-select");

function validate(fieldId) {
    const el = document.getElementById(fieldId);
    const hint = el.nextElementSibling;
    if (!el.value.trim()) {
        el.classList.add("invalid-field");
        hint.classList.remove("hidden");
        return false;
    }
    el.classList.remove("invalid-field");
    hint.classList.add("hidden");
    return true;
}

function validateLaptop() {
    const hint = laptopSelectEl.nextElementSibling;
    if (!laptopSelectEl.value.trim()) {
        laptopSelectEl.classList.add("invalid-field");
        hint.classList.remove("hidden");
        return false;
    }
    laptopSelectEl.classList.remove("invalid-field");
    hint.classList.add("hidden");
    return true;
}

form.addEventListener("submit", async e => {
    e.preventDefault();
    let valid = requiredFields.every(f => validate(f));
    valid = valid && validateLaptop();

    if (!valid) return;

    const data = {
        ime: form["ime"].value.trim(),
        prezime: form["prezime"].value.trim(),
        kontakt: form["kontakt-broj"].value.trim(),
        email: form["email"].value.trim(),
        laptopId: laptopSelectEl.value, // ID laptopa
        poruka: form["poruka"].value.trim()
    };

    try {
        const res = await fetch("https://formsubmit.co/ajax/sergej.kaldesic@gmail.com", {
            method: "POST",
            headers: { "Content-Type": "application/json", Accept: "application/json" },
            body: JSON.stringify(data),
        });
        if (!res.ok) throw new Error("Greška slanja forme");

        alert("Upit uspešno poslat!");
        form.reset();
    } catch (err) {
        console.error(err);
        alert("Došlo je do greške prilikom slanja forme.");
    }
});

/* =============================
   FUNKCIJA ZA OTVARANJE PRODUCT.HTML
============================= */
function goToProduct(id) {
    window.location.href = `product.html?selected=${id}`;
}
</script>
</body>
</html>
