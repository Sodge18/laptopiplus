<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>

    <title>Laptopi Plus Shop Page</title>

    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#333333",
                        "background-light": "#ffffff",
                        "background-dark": "#1f2937",
                    },
                    fontFamily: { display: ["Poppins", "sans-serif"] },
                    borderRadius: {
                        DEFAULT: "0.75rem",
                        xl: "1.25rem",
                        "2xl": "1.5rem",
                    },
                },
            },
        };
    </script>

    <style>
        [x-cloak] { display: none !important; }

        .carousel-container {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .carousel-container::-webkit-scrollbar {
            display: none;
        }

        body:has([x-show='detailModalOpen'][style*='display: block;']),
        body:has([x-show='searchModalOpen'][style*='display: block;']) {
            overflow: hidden;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-gray-700 dark:text-gray-300">

<!-- NAVBAR -->
<header class="py-6 px-4 sm:px-6 lg:px-8">
    <div class="container mx-auto flex justify-between items-center relative">
        <a class="text-2xl font-bold text-gray-900 dark:text-white" href="#">Laptopi Plus</a>

        <nav class="hidden md:flex items-center space-x-8 absolute left-1/2 -translate-x-1/2">
            <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-white font-semibold" href="#">Laptopi</a>
            <a class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-white font-semibold" href="#">Kontakt</a>
        </nav>
    </div>
</header>

<!-- HERO -->
<section class="relative h-96 flex items-center justify-center text-white overflow-hidden">
    <img alt="Hero" class="absolute inset-0 w-full h-full object-cover z-0"
         src="https://lh3.googleusercontent.com/aida-public/AB6AXuA5sVuCtmqZpZ0D8iLshqCe6NaEx0MCjcckHpCFulGhRxoTE1dNfTaFr1vSB7I5IQM2fwQjHE3VtjSyu6x_wgg17LC6MUYNEbcobkIuzjscpJWcohj8e9fqch19RWWUsRTs-XqnE8lBDaGxCBjf65aZd1cg79cNRSCfL3rdjhtuj3Z6zJt85ogQMiv1gNAyNnnVOO9t--q_C_M-Ft1U50YWUe-w_XV3w9jdAo_C76vKZqY4lskd91i6ZYtncUQP06fKFaE_SlMkUF_Y"/>
    <div class="absolute inset-0 bg-black opacity-50 z-10"></div>

    <div class="relative z-20 text-center">
        <h1 class="text-6xl md:text-8xl font-bold">Laptopi Plus</h1>
        <p class="mt-4 text-xl">Laptopi za sve namene!</p>
    </div>
</section>

<!-- CAROUSEL -->
<main class="container mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="text-center mb-12">
        <h2 class="text-3xl font-semibold text-gray-800 dark:text-gray-200">
            Odaberite laptop koji vama najviše odgovara
        </h2>
    </div>

    <div class="relative max-w-4xl mx-auto">

        <div id="carousel"
             class="carousel-container flex overflow-x-auto snap-x snap-mandatory scroll-smooth pb-4">
            <div class="w-full flex justify-center items-center h-96">
                <p class="text-gray-500">Učitavanje laptopova...</p>
            </div>
        </div>

        <!-- Strelice -->
        <button id="prev-btn"
                class="absolute top-1/2 left-0 -translate-y-1/2 -translate-x-12
                       bg-gray-100 dark:bg-gray-700/50 p-3 rounded-full shadow-md
                       hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors z-10">
            <span class="material-icons text-gray-800 dark:text-white">arrow_back_ios_new</span>
        </button>

        <button id="next-btn"
                class="absolute top-1/2 right-0 -translate-y-1/2 translate-x-12
                       bg-gray-100 dark:bg-gray-700/50 p-3 rounded-full shadow-md
                       hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors z-10">
            <span class="material-icons text-gray-800 dark:text-white">arrow_forward_ios</span>
        </button>
    </div>

    <div id="pagination-dots" class="flex justify-center items-center mt-12 space-x-2"></div>
</main>

<!-- MODAL ZA DETALJE PROIZVODA -->
<div id="product-modal"
     class="fixed inset-0 z-[70] hidden items-center justify-center bg-black bg-opacity-70 p-4">

    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden flex flex-col">

        <!-- Header -->
        <div class="flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700">
            <h3 id="modal-title"
                class="text-2xl font-bold text-gray-900 dark:text-white"></h3>

            <button onclick="closeModal()"
                    class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white">
                <span class="material-icons text-3xl">close</span>
            </button>
        </div>

        <!-- Body -->
        <div class="flex-1 overflow-y-auto p-6">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">

                <!-- Info -->
                <div>
                    <div class="mb-6">
                        <h4 id="modal-name"
                            class="text-3xl font-bold text-gray-900 dark:text-white"></h4>
                        <p id="modal-price"
                           class="text-3xl font-bold text-primary mt-2"></p>
                    </div>

                    <div class="mb-8">
                        <h5 class="font-semibold text-lg mb-3 text-gray-800 dark:text-gray-200">Opis</h5>
                        <p id="modal-description"
                           class="text-gray-600 dark:text-gray-400 leading-relaxed"></p>
                    </div>

                    <div>
                        <h5 class="font-semibold text-lg mb-3 text-gray-800 dark:text-gray-200">Specifikacije</h5>
                        <div id="modal-specs" class="space-y-2"></div>
                    </div>
                </div>

                <!-- Galerija -->
                <div>
                    <h5 class="font-semibold text-lg mb-4 text-gray-800 dark:text-gray-200">Galerija</h5>
                    <div id="modal-gallery" class="grid grid-cols-2 gap-4">
                        <!-- Auto-popunjavanje -->
                    </div>
                </div>

            </div>
        </div>

        <!-- Footer -->
        <div class="p-6 border-t border-gray-200 dark:border-gray-700 text-right bg-gray-50 dark:bg-gray-900">
            <button onclick="selectAndCloseModal()"
                    class="bg-primary text-white font-bold px-8 py-3 rounded-lg hover:bg-opacity-90 transition-all shadow-lg">
                Izaberi ovaj laptop
            </button>
        </div>
    </div>

</div>
<!-- KRAJ DETALJ MODALA -->


<!-- CONTACT FORMA + SELECT LAPTOP MODAL -->
<section class="container mx-auto px-4 sm:px-6 lg:px-8 py-16"
         id="contact-form-section"
         x-data="{ modalOpen: false }">

    <div class="bg-primary text-white rounded-2xl p-8 md:p-12">

        <div class="flex flex-col lg:flex-row gap-8 lg:gap-16">

            <!-- Left -->
            <div class="lg:w-1/3">
                <h2 class="text-4xl font-bold mb-4">Spremni da kupite laptop?</h2>
                <p class="text-gray-300">Popunite formu i bićemo u kontaktu.</p>
            </div>

            <!-- Form -->
            <div class="lg:w-2/3">

                <form id="contact-form" method="POST" action="https://products-api.sergej-kaldesic.workers.dev/send">

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-200 mb-2">Ime</label>
                            <input id="ime"
                                   type="text"
                                   placeholder="Unesite Vaše ime"
                                   class="w-full p-3 rounded-lg bg-gray-700 text-white"/>
                            <p class="error-hint hidden">Popunite polje</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-200 mb-2">Prezime</label>
                            <input id="prezime"
                                   type="text"
                                   placeholder="Unesite Vaše prezime"
                                   class="w-full p-3 rounded-lg bg-gray-700 text-white"/>
                            <p class="error-hint hidden">Popunite polje</p>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-200 mb-2">Kontakt broj</label>
                            <input id="kontakt-broj"
                                   type="tel"
                                   placeholder="061 234 567"
                                   class="w-full p-3 rounded-lg bg-gray-700 text-white"/>
                            <p class="error-hint hidden">Popunite polje</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-200 mb-2">Email</label>
                            <input id="email"
                                   type="email"
                                   placeholder="vas.email@example.com"
                                   class="w-full p-3 rounded-lg bg-gray-700 text-white"/>
                            <p class="error-hint hidden">Popunite polje</p>
                        </div>
                    </div>

                    <!-- SELECT LAPTOP BUTTON -->
                    <div>
                        <label class="block text-sm font-medium text-gray-200 mb-2">Koji laptop želite</label>

                        <input type="hidden" id="laptop-select-hidden"/>

                        <button id="laptop-select"
                                @click.prevent="modalOpen = true"
                                class="w-full p-3 rounded-lg bg-gray-700 text-white text-left flex justify-between items-center">
                            <span id="selected-laptop-text">Odaberite laptop</span>
                            <span class="material-icons">expand_more</span>
                        </button>

                        <p class="error-hint hidden">Morate izabrati laptop</p>
                    </div>

                    <!-- Submit -->
                    <div class="text-right">
                        <button type="submit"
                                class="bg-white text-primary font-semibold px-8 py-3 rounded-lg hover:bg-gray-200 transition shadow-md">
                            Pošalji
                        </button>
                    </div>

                </form>
            </div>

        </div>
    </div>

    <!-- LAPTOP SELECT MODAL -->
    <div x-cloak x-show="modalOpen"
         @click.away="modalOpen = false"
         class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-60 p-4">

        <div class="bg-background-light dark:bg-gray-800 rounded-2xl shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">

            <div class="flex justify-between items-center p-6 border-b border-gray-200 dark:border-gray-700">
                <h3 class="text-xl font-semibold">Odaberite Laptop</h3>
                <button @click="modalOpen = false"
                        class="text-gray-400 hover:text-gray-600 dark:hover:text-white">
                    <span class="material-icons">close</span>
                </button>
            </div>

            <div class="p-6 overflow-y-auto">
                <div id="modal-laptop-grid"
                     class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                    <!-- Dinamički prikaz proizvoda -->
                </div>
            </div>

        </div>
    </div>

</section>

<!-- GRID — SVI PROIZVODI -->
<section class="container mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <div class="text-center mb-12">
        <h2 class="text-3xl font-semibold text-gray-800 dark:text-gray-200">Svi naši proizvodi</h2>
        <p class="mt-2 text-gray-600 dark:text-gray-400">Pregledajte kompletnu ponudu laptopa.</p>
    </div>

    <div id="products-grid"
         class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
        <div class="col-span-full text-center py-20">
            <p class="text-gray-500">Učitavanje proizvoda...</p>
        </div>
    </div>
</section>


<!-- FOOTER -->
<footer class="bg-background-light dark:bg-background-dark">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="text-center text-sm text-gray-500 dark:text-gray-400">
            <p>Laptopi Plus — Laptopi za sve namene</p>
        </div>
    </div>
</footer>


<!-- ============================== -->
<!--       JAVASCRIPT CORE         -->
<!-- ============================== -->

<script>
const API_URL = "https://products-api.sergej-kaldesic.workers.dev/";
let allProducts = [];  // globalno za grid + modal

/* =============================
   LOADING PRODUCTS (CAROUSEL + GRID + SELECT MODAL)
============================= */
async function loadProducts() {
    try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error("Greška API: " + res.status);

        const data = await res.json();

        let products = Array.isArray(data.products) ? data.products :
                       Array.isArray(data) ? data : [];

        allProducts = products;

        renderCarousel(products);
        renderGrid(products);
        renderSelectModal(products);

    } catch (e) {
        console.error(e);
    }
}

document.addEventListener("DOMContentLoaded", loadProducts);


/* =============================
   RENDER CAROUSEL
============================= */
function renderCarousel(products) {
    const carousel = document.getElementById("carousel");
    const dots = document.getElementById("pagination-dots");

    if (!products.length) {
        carousel.innerHTML = `<p class="text-center text-gray-500 py-20">Nema laptopova.</p>`;
        return;
    }

    carousel.innerHTML = products.map((p, i) => {
        const img = p.image || p.images?.[0] || "https://via.placeholder.com/600?text=Laptop";
        const tag = p.tag ? `<span class="absolute top-4 left-4 bg-blue-100 text-blue-800 
                             text-xs font-bold px-3 py-1 rounded-full">${p.tag.toUpperCase()}</span>` : "";

        return `
        <div class="carousel-item snap-center flex-shrink-0 w-full flex justify-center p-4">
            <div class="group relative flex flex-col w-full max-w-sm">
                <div onclick='openModal(${JSON.stringify(p).replace(/'/g, "\\'")})' class="cursor-pointer">
                    <div class="relative w-full aspect-square bg-gray-100 dark:bg-gray-800 rounded-2xl overflow-hidden mb-6">
                        <img src="${img}" class="w-full h-full object-contain p-8 group-hover:scale-105 
                             transition-transform duration-300" alt="${p.title}">
                        ${tag}
                    </div>
                </div>

                <h3 class="font-semibold text-2xl text-center mb-2">${p.title}</h3>
                <p class="text-gray-500 dark:text-gray-400 text-base text-center mb-4">${p.shortDesc || ""}</p>

                <div class="text-center">
                    <p class="text-2xl font-bold">${p.price ? p.price + "€" : "Cena na upit"}</p>
                    <button class="mt-4 bg-primary text-white px-6 py-2 rounded-full hover:bg-opacity-90 w-full transition"
                            onclick="selectLaptop('${(p.title || "").replace(/'/g, "\\'")}')">
                        Izaberite Laptop
                    </button>

                    <button onclick='openModal(${JSON.stringify(p).replace(/'/g, "\\'")})'
                            class="mt-2 bg-gray-200 dark:bg-gray-700 px-6 py-2 rounded-full hover:bg-gray-300 
                                   dark:hover:bg-gray-600 w-full transition">
                        Detalji
                    </button>
                </div>
            </div>
        </div>`;
    }).join("");

    dots.innerHTML = products.map((_, i) =>
        `<button onclick="scrollToSlide(${i})"
                class="w-3 h-3 rounded-full transition-all ${i===0 ? "bg-primary w-8" : "bg-gray-300 dark:bg-gray-600"}">`
    ).join("");

    document.getElementById("prev-btn").onclick = () => scrollCarousel(-1);
    document.getElementById("next-btn").onclick = () => scrollCarousel(1);
    carousel.addEventListener("scroll", updateActiveDot);
    updateActiveDot();
}


/* =============================
   CAROUSEL NAVIGATION LOGIC
============================= */
function scrollCarousel(dir) {
    const carousel = document.getElementById("carousel");
    const width = carousel.clientWidth;
    carousel.scrollBy({ left: dir * width, behavior: "smooth" });
}

function scrollToSlide(i) {
    const carousel = document.getElementById("carousel");
    const width = carousel.clientWidth;
    carousel.scrollTo({ left: i * width, behavior: "smooth" });
}

function updateActiveDot() {
    const carousel = document.getElementById("carousel");
    const dots = document.querySelectorAll("#pagination-dots button");

    const scroll = carousel.scrollLeft + carousel.clientWidth / 2;
    const width = carousel.clientWidth;
    const active = Math.round(scroll / width);

    dots.forEach((d, i) => {
        d.classList.toggle("bg-primary", i === active);
        d.classList.toggle("w-8", i === active);
        d.classList.toggle("bg-gray-300", i !== active);
        d.classList.toggle("dark:bg-gray-600", i !== active);
        d.classList.toggle("w-3", i !== active);
    });
}


/* =============================
   RENDER GRID PRODUCTS
============================= */
function renderGrid(products) {
    const grid = document.getElementById("products-grid");

    if (!products.length) {
        grid.innerHTML = `<div class="col-span-full text-center py-20 text-gray-500 text-xl">
            Nema dostupnih proizvoda.
        </div>`;
        return;
    }

    grid.innerHTML = products.map(p => {
        const img = p.images?.[0] || p.image || "https://via.placeholder.com/600?text=Laptop";
        const shortDesc = p.shortDesc || "";

        return `
        <div onclick='openModal(${JSON.stringify(p).replace(/'/g, "\\'")})'
             class="group relative flex flex-col text-center bg-gray-50 dark:bg-gray-800 rounded-2xl 
                    overflow-hidden p-6 transition-all duration-300 hover:shadow-xl hover:-translate-y-2 cursor-pointer">

            <div class="relative w-full h-48 mb-4">
                <img src="${img}" alt="${p.title}"
                     class="w-full h-full object-contain group-hover:scale-105 transition-transform duration-300">
            </div>

            <h3 class="font-semibold text-lg text-gray-900 dark:text-white mb-1">${p.title}</h3>
            <p class="text-gray-500 dark:text-gray-400 text-sm mb-2 flex-grow">${shortDesc}</p>

            <p class="text-xl font-bold text-primary dark:text-gray-300">
                ${p.price ? p.price + "€" : "Cena na upit"}
            </p>
        </div>`;
    }).join("");
}


/* =============================
   RENDER SELECT LAPTOP MODAL GRID
============================= */
function renderSelectModal(products) {
    const modalGrid = document.getElementById("modal-laptop-grid");

    modalGrid.innerHTML = products.map(p => `
        <div onclick="selectModalLaptop('${p.title.replace(/'/g, "\\'")}')"
             class="bg-gray-100 dark:bg-gray-700/50 rounded-xl p-4 cursor-pointer
                    hover:ring-2 hover:ring-primary transition">

            <img src="${p.images?.[0] || p.image || ""}" 
                 class="w-full h-40 object-contain mb-3" alt="${p.title}">

            <h4 class="font-semibold text-gray-900 dark:text-white text-center">${p.title}</h4>
        </div>
    `).join("");
}


/* =============================
   MODAL HANDLING (open/close)
============================= */
let selectedProductGlobal = null;

function openModal(product) {
    selectedProductGlobal = product;

    document.getElementById("modal-title").textContent = product.title;
    document.getElementById("modal-name").textContent = product.title;
    document.getElementById("modal-price").textContent = product.price ? product.price + "€" : "Cena na upit";
    document.getElementById("modal-description").textContent = product.description || product.shortDesc || "";

    const specs = document.getElementById("modal-specs");
    specs.innerHTML = "";

    if (product.specs?.length) {
        product.specs.forEach(s => {
            specs.innerHTML += `
                <div class="flex justify-between p-3 rounded-lg bg-gray-100 dark:bg-gray-700/50">
                    <span class="font-medium">${s.label}</span>
                    <span class="font-semibold">${s.value}</span>
                </div>`;
        });
    } else {
        specs.innerHTML = `<p class="text-gray-500 italic">Nema specifikacija.</p>`;
    }

    const gallery = document.getElementById("modal-gallery");
    gallery.innerHTML = "";

    const images = product.images?.length ? product.images :
                    product.image ? [product.image] : [];

    images.forEach(src => {
        gallery.innerHTML += `
            <div class="aspect-square rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-700">
                <img src="${src}" class="w-full h-full object-contain">
            </div>`;
    });

    const modal = document.getElementById("product-modal");
    modal.classList.remove("hidden");
    modal.classList.add("flex");
}

function closeModal() {
    const modal = document.getElementById("product-modal");
    modal.classList.add("hidden");
    modal.classList.remove("flex");
}

function selectAndCloseModal() {
    if (selectedProductGlobal?.title) {
        selectLaptop(selectedProductGlobal.title);
    }
    closeModal();
}


/* =============================
   CONTACT FORMA VALIDACIJA
============================= */
const form = document.getElementById("contact-form");
const requiredFields = ["ime", "prezime", "kontakt-broj", "email"];

function validate(fieldId) {
    const el = document.getElementById(fieldId);
    const hint = el.nextElementSibling;

    if (!el.value.trim()) {
        el.classList.add("invalid-field");
        hint.classList.remove("hidden");
        return false;
    }

    el.classList.remove("invalid-field");
    hint.classList.add("hidden");
    return true;
}

form.addEventListener("submit", e => {
    e.preventDefault();

    let valid = true;

    requiredFields.forEach(f => {
        if (!validate(f)) valid = false;
    });

    if (!document.getElementById("laptop-select-hidden").value.trim()) {
        valid = false;
        document.getElementById("laptop-select").classList.add("invalid-field");
        document.querySelector("#laptop-select + p").classList.remove("hidden");
    }

    if (valid) {
        console.log("Form submitted.");
    }
});

requiredFields.forEach(f => {
    document.getElementById(f).addEventListener("input", () => validate(f));
});


/* =============================
   SELECT LAPTOP (form)
============================= */
function selectLaptop(name) {
    document.getElementById("selected-laptop-text").textContent = name;
    document.getElementById("laptop-select-hidden").value = name;

    document.getElementById("laptop-select").classList.remove("invalid-field");
    document.querySelector("#laptop-select + p").classList.add("hidden");

    document.getElementById("contact-form-section")
        .scrollIntoView({ behavior: "smooth", block: "center" });
}

function selectModalLaptop(name) {
    document.getElementById("selected-laptop-text").textContent = name;
    document.getElementById("laptop-select-hidden").value = name;

    document.getElementById("laptop-select").classList.remove("invalid-field");
    document.querySelector("#laptop-select + p").classList.add("hidden");
}
</script>

<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

</body>
</html>
